<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Registration - GuideEd</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 500px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            outline: none;
        }

        input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input::placeholder {
            color: #999;
        }

        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .location-info {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }

        .pac-container {
            z-index: 10000;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-top: 2px;
        }

        .loading {
            text-align: center;
            color: #666;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function RegistrationForm() {
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                password: '',
                location: ''
            });
            const [message, setMessage] = useState({ text: '', type: '' });
            const [loading, setLoading] = useState(false);
            const [autocomplete, setAutocomplete] = useState(null);
            const locationInputRef = useRef(null);

            useEffect(() => {
                // Load Google Maps Places API
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places`;
                script.async = true;
                script.defer = true;
                script.onload = initAutocomplete;
                document.head.appendChild(script);

                return () => {
                    document.head.removeChild(script);
                };
            }, []);

            const initAutocomplete = () => {
                if (!window.google) {
                    console.error('Google Maps API not loaded');
                    return;
                }

                const autocompleteInstance = new window.google.maps.places.Autocomplete(
                    locationInputRef.current,
                    {
                        types: ['geocode', 'establishment'],
                        fields: ['formatted_address', 'geometry', 'name', 'address_components']
                    }
                );

                autocompleteInstance.addListener('place_changed', () => {
                    const place = autocompleteInstance.getPlace();
                    
                    if (place.formatted_address) {
                        setFormData(prev => ({
                            ...prev,
                            location: place.formatted_address
                        }));
                    } else if (place.name) {
                        setFormData(prev => ({
                            ...prev,
                            location: place.name
                        }));
                    }
                });

                setAutocomplete(autocompleteInstance);
            };

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
                setMessage({ text: '', type: '' });
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setMessage({ text: '', type: '' });

                // Validate form
                if (!formData.name || !formData.email || !formData.password || !formData.location) {
                    setMessage({ text: 'All fields are required', type: 'error' });
                    setLoading(false);
                    return;
                }

                try {
                    const response = await fetch('http://localhost:8000/api/v1/users/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });

                    const data = await response.json();

                    if (response.ok) {
                        setMessage({ text: 'Registration successful!', type: 'success' });
                        setFormData({ name: '', email: '', password: '', location: '' });
                    } else {
                        setMessage({ text: data.message || 'Registration failed', type: 'error' });
                    }
                } catch (error) {
                    setMessage({ text: 'Error connecting to server', type: 'error' });
                    console.error('Registration error:', error);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="container">
                    <h1>Create Account</h1>
                    <p className="subtitle">Join GuideEd to start your journey</p>
                    
                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label htmlFor="name">Full Name</label>
                            <input
                                type="text"
                                id="name"
                                name="name"
                                value={formData.name}
                                onChange={handleChange}
                                placeholder="Enter your full name"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label htmlFor="email">Email Address</label>
                            <input
                                type="email"
                                id="email"
                                name="email"
                                value={formData.email}
                                onChange={handleChange}
                                placeholder="you@example.com"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label htmlFor="password">Password</label>
                            <input
                                type="password"
                                id="password"
                                name="password"
                                value={formData.password}
                                onChange={handleChange}
                                placeholder="Min. 6 characters"
                                minLength="6"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label htmlFor="location">Location</label>
                            <input
                                ref={locationInputRef}
                                type="text"
                                id="location"
                                name="location"
                                value={formData.location}
                                onChange={handleChange}
                                placeholder="Start typing your location..."
                                required
                            />
                            <div className="location-info">
                                ðŸ’¡ Start typing to see location suggestions from Google Maps
                            </div>
                        </div>

                        <button type="submit" disabled={loading}>
                            {loading ? 'Creating Account...' : 'Create Account'}
                        </button>
                    </form>

                    {message.text && (
                        <div className={`message ${message.type}`}>
                            {message.text}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RegistrationForm />);
    </script>
</body>
</html>
